<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>GreenWatch Local Test</title>
  <style>
    body { font-family: sans-serif; max-width: 760px; margin: 24px auto; }
    #log { border: 1px solid #ccc; padding: 12px; min-height: 220px; white-space: pre-wrap; }
    input { width: 78%; padding: 8px; }
    button { padding: 8px 12px; }
  </style>
</head>
<body>
  <h2>GreenWatch Runner Test</h2>
  <div>
    <button id="start">Start session</button>
    <span id="sid"></span>
  </div>
  <br/>
  <div id="log"></div>
  <br/>
  <input id="msg" placeholder="Type a message..." />
  <button id="send">Send</button>

<script>
const API = "http://127.0.0.1:8080";
let sessionId = null;

function append(role, text) {
  const log = document.getElementById("log");
  log.textContent += `${role}: ${text}\n\n`;
  log.scrollTop = log.scrollHeight;
}

document.getElementById("start").onclick = async () => {
  const r = await fetch(`${API}/session/start`, { method: "POST" });
  const j = await r.json();
  sessionId = j.session_id;
  document.getElementById("sid").textContent = `session_id=${sessionId}`;
  append("system", "Session started.");
  append("assistant", "Hi â€” tell me a bit about what's going on.");
};

async function send() {
  const text = document.getElementById("msg").value.trim();
  if (!text) return;
  if (!sessionId) { alert("Click Start session first"); return; }

  document.getElementById("msg").value = "";
  append("user", text);

  const r = await fetch(`${API}/session/message`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ session_id: sessionId, user_text: text })
  });

  const j = await r.json();
  append("assistant", j.assistant_text);
}

document.getElementById("send").onclick = send;
document.getElementById("msg").addEventListener("keydown", (e) => {
  if (e.key === "Enter") send();
});
</script>
</body>
</html>
